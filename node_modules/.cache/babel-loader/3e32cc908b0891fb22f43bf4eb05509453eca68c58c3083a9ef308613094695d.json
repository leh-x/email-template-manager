{"ast":null,"code":"// src/views/EmailCompilerView/EmailCompilerView.tsx\nimport React,{useEffect,useState,useMemo}from'react';import{core}from'@tauri-apps/api';import clipboard from'tauri-plugin-clipboard-api';import TemplateList from'../components/TemplateList/TemplateList';import{CopyIcon20,SaveIcon24}from'../ui/icons';import{COLOURS}from'../ui/theme/theme';import{useToast}from'../ui/toast';import{STRINGS}from'../ui/strings';import elements from'../ui/elements.module.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LEFT_MIN_WIDTH=220;const LEFT_MAX_WIDTH=350;const GUTTER='1rem';const EDITOR_MIN_HEIGHT=220;const SIGNATURE_LOGO_WIDTH=300;export default function EmailCompilerView(){var _selectedTemplate$nam;// Left column selection\nconst[selectedTemplate,setSelectedTemplate]=useState(null);// Editor body\nconst[templateBody,setTemplateBody]=useState('');// Salutation / Valediction / Recipient\nconst[salutations,setSalutations]=useState([]);const[valedictions,setValedictions]=useState([]);const[selectedSalutation,setSelectedSalutation]=useState('');const[selectedValediction,setSelectedValediction]=useState('');const[recipient,setRecipient]=useState('');// Signatures\nconst[signatureNames,setSignatureNames]=useState([]);const[selectedSignatureName,setSelectedSignatureName]=useState('');const[selectedSignature,setSelectedSignature]=useState(null);const[signatureImageB64,setSignatureImageB64]=useState(null);const{showToast}=useToast();// Load salutations, valedictions, and signature names\nuseEffect(()=>{// Load salutations and default to the first item (keep \"— none —\" as an explicit choice).\ncore.invoke('load_salutations').then(arr=>{setSalutations(arr);setSelectedSalutation(prev=>{var _arr$;return prev||((_arr$=arr[0])!==null&&_arr$!==void 0?_arr$:'');});}).catch(()=>{const fallback=['Hello','Hi','Good morning'];setSalutations(fallback);setSelectedSalutation(prev=>prev||fallback[0]);});// Load valedictions and default to the first item (keep \"— none —\" as an explicit choice).\ncore.invoke('load_valedictions').then(arr=>{setValedictions(arr);setSelectedValediction(prev=>{var _arr$2;return prev||((_arr$2=arr[0])!==null&&_arr$2!==void 0?_arr$2:'');});}).catch(()=>{const fallback=['Thanks','Sincerely','Kind regards'];setValedictions(fallback);setSelectedValediction(prev=>prev||fallback[0]);});core.invoke('load_signatures').then(setSignatureNames).catch(err=>console.error('Failed to load signatures',err));},[]);// Handle template selection from the list\nconst handleSelectTemplate=tpl=>{setSelectedTemplate(tpl);setTemplateBody(tpl.content);};// Persist changes to template body\nconst handleSaveTemplate=async()=>{if(!selectedTemplate)return;try{await core.invoke('save_template',{name:selectedTemplate.name,content:templateBody});showToast({message:STRINGS.savedChanges,variant:'success'});// reflect last modified locally\nsetSelectedTemplate(prev=>prev?{...prev,content:templateBody,last_modified:new Date().toISOString()}:prev);}catch(err){console.error('Failed to save template',err);}};// Load full signature when selection changes\nuseEffect(()=>{if(!selectedSignatureName){setSelectedSignature(null);setSignatureImageB64(null);return;}core.invoke('load_signature_file',{name:selectedSignatureName}).then(sig=>{setSelectedSignature(sig);if(sig.image_filename){core.invoke('get_signature_image_base64',{filename:sig.image_filename}).then(setSignatureImageB64).catch(()=>setSignatureImageB64(null));}else{setSignatureImageB64(null);}}).catch(err=>console.error('Failed to load signature file',err));},[selectedSignatureName]);useEffect(()=>{core.invoke('load_cache').then(cache=>{if(cache.email_view_last_selected_salutation){setSelectedSalutation(cache.email_view_last_selected_salutation);}if(cache.email_view_last_selected_valediction){setSelectedValediction(cache.email_view_last_selected_valediction);}if(cache.email_view_last_selected_signature){setSelectedSignatureName(cache.email_view_last_selected_signature);}}).catch(err=>console.error('Failed to load cache:',err));},[]);useEffect(()=>{const t=setTimeout(()=>{const patch={email_view_last_selected_salutation:selectedSalutation||null,email_view_last_selected_valediction:selectedValediction||null,email_view_last_selected_signature:selectedSignatureName||null};core.invoke('update_cache',{patch}).catch(err=>console.error('Failed to update cache:',err));},300);return()=>clearTimeout(t);},[selectedSalutation,selectedValediction,selectedSignatureName]);// Compose HTML + plaintext\nconst composed=useMemo(()=>{var _selectedSignature$lo,_selectedSignature$lo2;const escapeHtml=s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');const nl2br=s=>escapeHtml(s).replace(/\\r?\\n/g,'<br/>');// Inside useMemo(...)\nconst name=recipient.trim();// Start from the selected salutation, but strip any trailing comma so we don't get \"Hello, Alex,\"\nconst salBase=(selectedSalutation||'').replace(/,\\s*$/,'').trim();// If there's a name, append it with a single space; otherwise just use the salutation\nconst sal=salBase?name?`${salBase} ${name}`:salBase:'';// \"ensure one comma\" rule still applies:\nconst salHtml=sal?`<p>${nl2br(sal)}${sal.endsWith(',')?'':','}</p>`:'';const bodyHtml=`<div>${nl2br(templateBody)}</div>`;const valHtml=selectedValediction?`<p style=\"margin-top:1rem;\">${nl2br(selectedValediction)}${selectedValediction.endsWith(',')?'':','}</p>`:'';const sigHtml=((_s$location$address,_s$location)=>{if(!selectedSignature)return'';const s=selectedSignature;const img=signatureImageB64?`<br><img src=\"data:image/png;base64,${signatureImageB64}\" width=\"${SIGNATURE_LOGO_WIDTH}\"\n                 style=\"display:block;width:${SIGNATURE_LOGO_WIDTH}px;height:auto;margin-top:1rem;border:0;outline:0;text-decoration:none;\"\n                 alt=\"Signature image\" />`:'';return`\n        <div>\n          <strong>${escapeHtml(s.name)}</strong><br/>\n          ${escapeHtml(`${s.position}, ${s.department}`)}<br/>\n          ${escapeHtml(s.company)}<br/>\n          ${escapeHtml((_s$location$address=(_s$location=s.location)===null||_s$location===void 0?void 0:_s$location.address)!==null&&_s$location$address!==void 0?_s$location$address:'')}\n          ${img}\n        </div>\n      `;})();const html=`\n      <div style=\"font-family:-apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#111827;\">\n        ${salHtml}${bodyHtml}${valHtml}${sigHtml}\n      </div>\n    `;const plain=[sal?sal.endsWith(',')?sal:`${sal},`:'',templateBody,selectedValediction?`${selectedValediction},`:'',selectedSignature?[selectedSignature.name,`${selectedSignature.position}, ${selectedSignature.department}`,selectedSignature.company,(_selectedSignature$lo=(_selectedSignature$lo2=selectedSignature.location)===null||_selectedSignature$lo2===void 0?void 0:_selectedSignature$lo2.address)!==null&&_selectedSignature$lo!==void 0?_selectedSignature$lo:''].filter(Boolean).join('\\n'):''].filter(s=>s&&s.trim().length>0).join('\\n\\n');return{html,plain};},[selectedSalutation,recipient,templateBody,selectedValediction,selectedSignature,signatureImageB64]);const handleCopy=async()=>{try{await clipboard.writeHtml(composed.html);showToast({message:STRINGS.copiedToClipboard,variant:'success'});}catch(err){console.error('Failed to copy composed email',err);}};return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',height:'100dvh',padding:'1rem',boxSizing:'border-box',width:'100%'// helps avoid accidental expansion past viewport\n// NOTE: do NOT set overflowX:'hidden' here if you want page-level horizontal\n// scroll to be possible; keep default so only the *page* can scroll sideways.\n},children:[/*#__PURE__*/_jsx(\"div\",{style:{// Give the column a responsive width that never exceeds LEFT_MAX_WIDTH\nwidth:`clamp(${LEFT_MIN_WIDTH}px, 26vw, ${LEFT_MAX_WIDTH}px)`,flex:'0 0 auto',borderRight:`1px solid ${COLOURS.divider}`,paddingRight:GUTTER,overflowY:'auto',// independent vertical scroll\noverflowX:'hidden',// never show a horizontal scrollbar here\nminHeight:0// required for scroll inside flex child\n},children:/*#__PURE__*/_jsx(TemplateList,{selectedName:(_selectedTemplate$nam=selectedTemplate===null||selectedTemplate===void 0?void 0:selectedTemplate.name)!==null&&_selectedTemplate$nam!==void 0?_selectedTemplate$nam:null,onSelectTemplate:handleSelectTemplate})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 auto',minWidth:0,// <-- CRUCIAL: allow shrinking within flex\npaddingLeft:GUTTER,overflowY:'auto',// independent vertical scroll\noverflowX:'hidden'// never show a horizontal scrollbar here\n},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'min-content 3fr 0.5fr',gap:8,marginBottom:12,alignItems:'end'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:elements.subtitle,children:\"Opening\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedSalutation,onChange:e=>setSelectedSalutation(e.target.value),className:elements.select,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u2014 none \\u2014\"}),salutations.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s,children:s},s))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:elements.subtitle,children:\"Recipient\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:recipient,onChange:e=>setRecipient(e.target.value),placeholder:\"e.g., Alex\",className:elements.input})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:12},children:[/*#__PURE__*/_jsx(\"label\",{className:elements.subtitle,children:\"Template body\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'// allow the overlayed toolbar to stay within rounded corners if you wish\n// overflow: 'hidden',\n},children:[/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:8,right:8,display:'flex',gap:8,zIndex:1},\"aria-label\":\"Editor toolbar\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCopy,className:elements.iconBtn,title:\"Copy composed email\",\"aria-label\":\"Copy composed email\",children:/*#__PURE__*/_jsx(CopyIcon20,{})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleSaveTemplate,disabled:!selectedTemplate,className:elements.iconBtn,title:\"Save changed template\",\"aria-label\":\"Save changed Template\",children:/*#__PURE__*/_jsx(SaveIcon24,{})})]}),/*#__PURE__*/_jsx(\"textarea\",{value:templateBody,onChange:e=>setTemplateBody(e.target.value),placeholder:selectedTemplate?'':'Select a template to edit…',readOnly:!selectedTemplate,wrap:\"soft\",style:{boxSizing:'border-box',// prevents right-edge overflow\nwidth:'100%',maxWidth:'100%',minHeight:EDITOR_MIN_HEIGHT,maxHeight:'70vh',padding:'44px 12px 12px 12px',// <-- extra top padding for toolbar clearance\nborderRadius:8,border:`1px solid ${COLOURS.border}`,resize:'vertical',whiteSpace:'pre-wrap',overflowWrap:'anywhere',wordBreak:'break-word',fontFamily:'ui-monospace, SFMono-Regular, Menlo, Consolas, monospace',fontSize:14,lineHeight:1.5,background:selectedTemplate?'#fff':'#f9fafb'}})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'min-content min-content 1fr',gap:8,marginBottom:12},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:elements.subtitle,children:\"Closing\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedValediction,onChange:e=>setSelectedValediction(e.target.value),className:elements.select,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u2014 none \\u2014\"}),valedictions.map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:elements.subtitle,children:\"Signature\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedSignatureName,onChange:e=>setSelectedSignatureName(e.target.value),className:elements.select,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u2014 none \\u2014\"}),signatureNames.map(n=>/*#__PURE__*/_jsx(\"option\",{value:n,children:n},n))]})]})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useMemo","core","clipboard","TemplateList","CopyIcon20","SaveIcon24","COLOURS","useToast","STRINGS","elements","jsx","_jsx","jsxs","_jsxs","LEFT_MIN_WIDTH","LEFT_MAX_WIDTH","GUTTER","EDITOR_MIN_HEIGHT","SIGNATURE_LOGO_WIDTH","EmailCompilerView","_selectedTemplate$nam","selectedTemplate","setSelectedTemplate","templateBody","setTemplateBody","salutations","setSalutations","valedictions","setValedictions","selectedSalutation","setSelectedSalutation","selectedValediction","setSelectedValediction","recipient","setRecipient","signatureNames","setSignatureNames","selectedSignatureName","setSelectedSignatureName","selectedSignature","setSelectedSignature","signatureImageB64","setSignatureImageB64","showToast","invoke","then","arr","prev","_arr$","catch","fallback","_arr$2","err","console","error","handleSelectTemplate","tpl","content","handleSaveTemplate","name","message","savedChanges","variant","last_modified","Date","toISOString","sig","image_filename","filename","cache","email_view_last_selected_salutation","email_view_last_selected_valediction","email_view_last_selected_signature","t","setTimeout","patch","clearTimeout","composed","_selectedSignature$lo","_selectedSignature$lo2","escapeHtml","s","replace","nl2br","trim","salBase","sal","salHtml","endsWith","bodyHtml","valHtml","sigHtml","_s$location$address","_s$location","img","position","department","company","location","address","html","plain","filter","Boolean","join","length","handleCopy","writeHtml","copiedToClipboard","style","display","height","padding","boxSizing","width","children","flex","borderRight","divider","paddingRight","overflowY","overflowX","minHeight","selectedName","onSelectTemplate","minWidth","paddingLeft","gridTemplateColumns","gap","marginBottom","alignItems","className","subtitle","value","onChange","e","target","select","map","type","placeholder","input","top","right","zIndex","onClick","iconBtn","title","disabled","readOnly","wrap","maxWidth","maxHeight","borderRadius","border","resize","whiteSpace","overflowWrap","wordBreak","fontFamily","fontSize","lineHeight","background","v","n"],"sources":["C:/Users/lhaveman/email-generator/src/views/EmailCompilerView.tsx"],"sourcesContent":["// src/views/EmailCompilerView/EmailCompilerView.tsx\r\nimport React, { useEffect, useState, useMemo } from 'react';\r\nimport { core } from '@tauri-apps/api';\r\nimport clipboard from 'tauri-plugin-clipboard-api';\r\nimport TemplateList, { TemplateFile } from '../components/TemplateList/TemplateList';\r\n\r\nimport { CopyIcon20, SaveIcon24 } from '../ui/icons';\r\nimport { COLOURS } from '../ui/theme/theme';\r\nimport { useToast } from '../ui/toast';\r\nimport { STRINGS } from '../ui/strings';\r\n\r\nimport elements from '../ui/elements.module.css';\r\n\r\ntype SignatureFile = {\r\n  signature_name: string;\r\n  name: string;\r\n  position: string;\r\n  department: string;\r\n  company: string;\r\n  location: { name: string; address: string };\r\n  image_filename: string | null;\r\n};\r\n\r\nconst LEFT_MIN_WIDTH = 220;\r\nconst LEFT_MAX_WIDTH = 350;\r\nconst GUTTER = '1rem';\r\nconst EDITOR_MIN_HEIGHT = 220;\r\nconst SIGNATURE_LOGO_WIDTH = 300;\r\n\r\nexport default function EmailCompilerView() {\r\n  // Left column selection\r\n  const [selectedTemplate, setSelectedTemplate] = useState<TemplateFile | null>(null);\r\n\r\n  // Editor body\r\n  const [templateBody, setTemplateBody] = useState('');\r\n\r\n  // Salutation / Valediction / Recipient\r\n  const [salutations, setSalutations] = useState<string[]>([]);\r\n  const [valedictions, setValedictions] = useState<string[]>([]);\r\n  const [selectedSalutation, setSelectedSalutation] = useState<string>('');\r\n  const [selectedValediction, setSelectedValediction] = useState<string>('');\r\n  const [recipient, setRecipient] = useState<string>('');\r\n\r\n  // Signatures\r\n  const [signatureNames, setSignatureNames] = useState<string[]>([]);\r\n  const [selectedSignatureName, setSelectedSignatureName] = useState<string>('');\r\n  const [selectedSignature, setSelectedSignature] = useState<SignatureFile | null>(null);\r\n  const [signatureImageB64, setSignatureImageB64] = useState<string | null>(null);\r\n\r\n  const { showToast } = useToast();\r\n\r\n  // Load salutations, valedictions, and signature names\r\n  useEffect(() => {\r\n    // Load salutations and default to the first item (keep \"— none —\" as an explicit choice).\r\n    core.invoke<string[]>('load_salutations')\r\n      .then((arr) => {\r\n        setSalutations(arr);\r\n        setSelectedSalutation((prev) => prev || (arr[0] ?? ''));\r\n      })\r\n      .catch(() => {\r\n        const fallback = ['Hello', 'Hi', 'Good morning'];\r\n        setSalutations(fallback);\r\n        setSelectedSalutation((prev) => prev || fallback[0]);\r\n      });\r\n\r\n    // Load valedictions and default to the first item (keep \"— none —\" as an explicit choice).\r\n    core.invoke<string[]>('load_valedictions')\r\n      .then((arr) => {\r\n        setValedictions(arr);\r\n        setSelectedValediction((prev) => prev || (arr[0] ?? ''));\r\n      })\r\n      .catch(() => {\r\n        const fallback = ['Thanks', 'Sincerely', 'Kind regards'];\r\n        setValedictions(fallback);\r\n        setSelectedValediction((prev) => prev || fallback[0]);\r\n      });\r\n\r\n    core.invoke<string[]>('load_signatures')\r\n      .then(setSignatureNames)\r\n      .catch((err) => console.error('Failed to load signatures', err));\r\n  }, []);\r\n\r\n  // Handle template selection from the list\r\n  const handleSelectTemplate = (tpl: TemplateFile) => {\r\n    setSelectedTemplate(tpl);\r\n    setTemplateBody(tpl.content);\r\n  };\r\n\r\n  // Persist changes to template body\r\n  const handleSaveTemplate = async () => {\r\n    if (!selectedTemplate) return;\r\n    try {\r\n      await core.invoke('save_template', { name: selectedTemplate.name, content: templateBody });\r\n      showToast({ message: STRINGS.savedChanges, variant: 'success' });\r\n      // reflect last modified locally\r\n      setSelectedTemplate((prev) =>\r\n        prev ? { ...prev, content: templateBody, last_modified: new Date().toISOString() } : prev\r\n      );\r\n    } catch (err) {\r\n      console.error('Failed to save template', err);\r\n    }\r\n  };\r\n\r\n  // Load full signature when selection changes\r\n  useEffect(() => {\r\n    if (!selectedSignatureName) {\r\n      setSelectedSignature(null);\r\n      setSignatureImageB64(null);\r\n      return;\r\n    }\r\n    core.invoke<SignatureFile>('load_signature_file', { name: selectedSignatureName })\r\n      .then((sig) => {\r\n        setSelectedSignature(sig);\r\n        if (sig.image_filename) {\r\n          core.invoke<string>('get_signature_image_base64', { filename: sig.image_filename })\r\n            .then(setSignatureImageB64)\r\n            .catch(() => setSignatureImageB64(null));\r\n        } else {\r\n          setSignatureImageB64(null);\r\n        }\r\n      })\r\n      .catch((err) => console.error('Failed to load signature file', err));\r\n  }, [selectedSignatureName]);\r\n\r\n\r\n  useEffect(() => {\r\n    core.invoke<{\r\n      email_view_last_selected_signature: string | null,\r\n      email_view_last_selected_salutation: string | null,\r\n      email_view_last_selected_valediction: string | null\r\n    }>('load_cache')\r\n      .then((cache) => {\r\n        if (cache.email_view_last_selected_salutation) {\r\n          setSelectedSalutation(cache.email_view_last_selected_salutation);\r\n        }\r\n        if (cache.email_view_last_selected_valediction) {\r\n          setSelectedValediction(cache.email_view_last_selected_valediction);\r\n        }\r\n        if (cache.email_view_last_selected_signature) {\r\n          setSelectedSignatureName(cache.email_view_last_selected_signature);\r\n        }\r\n      })\r\n      .catch((err) => console.error('Failed to load cache:', err));\r\n  }, []);\r\n\r\n\r\n  useEffect(() => {\r\n    const t = setTimeout(() => {\r\n      const patch: Record<string, string | null> = {\r\n        email_view_last_selected_salutation: selectedSalutation || null,\r\n        email_view_last_selected_valediction: selectedValediction || null,\r\n        email_view_last_selected_signature: selectedSignatureName || null,\r\n      };\r\n      core.invoke('update_cache', { patch })\r\n        .catch(err => console.error('Failed to update cache:', err));\r\n    }, 300);\r\n    return () => clearTimeout(t);\r\n  }, [selectedSalutation, selectedValediction, selectedSignatureName]);\r\n\r\n\r\n  // Compose HTML + plaintext\r\n  const composed = useMemo(() => {\r\n    const escapeHtml = (s: string) =>\r\n      s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\r\n\r\n    const nl2br = (s: string) => escapeHtml(s).replace(/\\r?\\n/g, '<br/>');\r\n\r\n    // Inside useMemo(...)\r\n    const name = recipient.trim();\r\n\r\n    // Start from the selected salutation, but strip any trailing comma so we don't get \"Hello, Alex,\"\r\n    const salBase = (selectedSalutation || '').replace(/,\\s*$/, '').trim();\r\n\r\n    // If there's a name, append it with a single space; otherwise just use the salutation\r\n    const sal = salBase ? (name ? `${salBase} ${name}` : salBase) : '';\r\n\r\n    // \"ensure one comma\" rule still applies:\r\n    const salHtml = sal ? `<p>${nl2br(sal)}${sal.endsWith(',') ? '' : ','}</p>` : '';\r\n    const bodyHtml = `<div>${nl2br(templateBody)}</div>`;\r\n    const valHtml = selectedValediction ? `<p style=\"margin-top:1rem;\">${nl2br(selectedValediction)}${selectedValediction.endsWith(',') ? '' : ','}</p>` : '';\r\n\r\n    const sigHtml = (() => {\r\n      if (!selectedSignature) return '';\r\n      const s = selectedSignature;\r\n      const img = signatureImageB64\r\n        ? `<br><img src=\"data:image/png;base64,${signatureImageB64}\" width=\"${SIGNATURE_LOGO_WIDTH}\"\r\n                 style=\"display:block;width:${SIGNATURE_LOGO_WIDTH}px;height:auto;margin-top:1rem;border:0;outline:0;text-decoration:none;\"\r\n                 alt=\"Signature image\" />`\r\n        : '';\r\n      return `\r\n        <div>\r\n          <strong>${escapeHtml(s.name)}</strong><br/>\r\n          ${escapeHtml(`${s.position}, ${s.department}`)}<br/>\r\n          ${escapeHtml(s.company)}<br/>\r\n          ${escapeHtml(s.location?.address ?? '')}\r\n          ${img}\r\n        </div>\r\n      `;\r\n    })();\r\n\r\n    const html = `\r\n      <div style=\"font-family:-apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#111827;\">\r\n        ${salHtml}${bodyHtml}${valHtml}${sigHtml}\r\n      </div>\r\n    `;\r\n\r\n    const plain = [\r\n      sal ? (sal.endsWith(',') ? sal : `${sal},`) : '',\r\n      templateBody,\r\n      selectedValediction ? `${selectedValediction},` : '',\r\n      selectedSignature\r\n        ? [\r\n            selectedSignature.name,\r\n            `${selectedSignature.position}, ${selectedSignature.department}`,\r\n            selectedSignature.company,\r\n            selectedSignature.location?.address ?? '',\r\n          ].filter(Boolean).join('\\n')\r\n        : '',\r\n    ]\r\n      .filter((s) => s && s.trim().length > 0)\r\n      .join('\\n\\n');\r\n\r\n    return { html, plain };\r\n  }, [selectedSalutation, recipient, templateBody, selectedValediction, selectedSignature, signatureImageB64]);\r\n\r\n  const handleCopy = async () => {\r\n    try {\r\n      await clipboard.writeHtml(composed.html);\r\n      showToast({ message: STRINGS.copiedToClipboard, variant: 'success' });\r\n    } catch (err) {\r\n      console.error('Failed to copy composed email', err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      style={{ \r\n        display: 'flex', \r\n        height: '100dvh', \r\n        padding: '1rem',\r\n        boxSizing: 'border-box',\r\n        width: '100%',                  // helps avoid accidental expansion past viewport\r\n      // NOTE: do NOT set overflowX:'hidden' here if you want page-level horizontal\r\n      // scroll to be possible; keep default so only the *page* can scroll sideways.\r\n      }}\r\n    >\r\n      {/* LEFT: reuse TemplateList (Templates + search + favourites) */}\r\n      <div\r\n        style={{\r\n          // Give the column a responsive width that never exceeds LEFT_MAX_WIDTH\r\n          width: `clamp(${LEFT_MIN_WIDTH}px, 26vw, ${LEFT_MAX_WIDTH}px)`,\r\n          flex: '0 0 auto',\r\n          borderRight: `1px solid ${COLOURS.divider}`,\r\n          paddingRight: GUTTER,\r\n          overflowY: 'auto',                // independent vertical scroll\r\n          overflowX: 'hidden',              // never show a horizontal scrollbar here\r\n          minHeight: 0,                     // required for scroll inside flex child\r\n        }}\r\n      >\r\n        <TemplateList\r\n          selectedName={selectedTemplate?.name ?? null}\r\n          onSelectTemplate={handleSelectTemplate}\r\n        />\r\n      </div>\r\n\r\n      {/* RIGHT: Composer */}\r\n      <div \r\n        style={{ \r\n          flex: '1 1 auto', \r\n          minWidth: 0,                      // <-- CRUCIAL: allow shrinking within flex\r\n          paddingLeft: GUTTER,\r\n          overflowY: 'auto',                // independent vertical scroll\r\n          overflowX: 'hidden',              // never show a horizontal scrollbar here\r\n        }}\r\n      >\r\n        {/* Row 1: Salutation + Recipient + Copy */}\r\n        <div \r\n          style={{ \r\n            display: 'grid', \r\n            gridTemplateColumns: 'min-content 3fr 0.5fr', \r\n            gap: 8, \r\n            marginBottom: 12, \r\n            alignItems: 'end' }}>\r\n          <div>\r\n            <label\r\n              className= { elements.subtitle }\r\n            >\r\n              Opening\r\n            </label>\r\n\r\n            <select\r\n              value={selectedSalutation}\r\n              onChange={(e) => setSelectedSalutation(e.target.value)}\r\n              className= { elements.select }\r\n            >\r\n              <option value=\"\">— none —</option>\r\n              {salutations.map((s) => <option key={s} value={s}>{s}</option>)}\r\n            </select>\r\n          </div>\r\n\r\n\r\n          <div>\r\n            <label \r\n              className= { elements.subtitle }\r\n            >\r\n              Recipient\r\n            </label>\r\n\r\n            <input\r\n              type=\"text\"\r\n              value={recipient}\r\n              onChange={(e) => setRecipient(e.target.value)}\r\n              placeholder=\"e.g., Alex\"\r\n              className= { elements.input }\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Row 2: Template editor + Save */}\r\n        <div style={{ marginBottom: 12 }}>\r\n          <label\r\n            className= { elements.subtitle }\r\n          >\r\n            Template body\r\n          </label>\r\n\r\n          <div\r\n              style={{\r\n                position: 'relative',\r\n                // allow the overlayed toolbar to stay within rounded corners if you wish\r\n                // overflow: 'hidden',\r\n              }}\r\n            >\r\n              {/* Floating toolbar – visually inside the editor area */}\r\n              <div\r\n                style={{\r\n                  position: 'absolute',\r\n                  top: 8,\r\n                  right: 8,\r\n                  display: 'flex',\r\n                  gap: 8,\r\n                  zIndex: 1,\r\n                }}\r\n                aria-label=\"Editor toolbar\"\r\n              >\r\n                <button\r\n                  type=\"button\"\r\n                  onClick= { handleCopy }\r\n                  className= { elements.iconBtn }\r\n                  title=\"Copy composed email\"\r\n                  aria-label=\"Copy composed email\"\r\n                >\r\n                  <CopyIcon20 />\r\n                </button>\r\n\r\n                <button\r\n                  type=\"button\"\r\n                  onClick= { handleSaveTemplate }\r\n                  disabled= { !selectedTemplate }\r\n                  className= { elements.iconBtn }\r\n                  title=\"Save changed template\"\r\n                  aria-label=\"Save changed Template\"\r\n                >\r\n                  <SaveIcon24/>\r\n                </button>\r\n              </div>\r\n\r\n              {/* The textarea gets extra top padding so text never hides under the toolbar */}\r\n              <textarea\r\n                value={templateBody}\r\n                onChange={(e) => setTemplateBody(e.target.value)}\r\n                placeholder={selectedTemplate ? '' : 'Select a template to edit…'}\r\n                readOnly={!selectedTemplate}\r\n                wrap=\"soft\"\r\n                style={{\r\n                  boxSizing: 'border-box',  // prevents right-edge overflow\r\n                  width: '100%',\r\n                  maxWidth: '100%',\r\n                  minHeight: EDITOR_MIN_HEIGHT,\r\n                  maxHeight: '70vh',\r\n                  padding: '44px 12px 12px 12px', // <-- extra top padding for toolbar clearance\r\n                  borderRadius: 8,\r\n                  border: `1px solid ${COLOURS.border}`,\r\n                  resize: 'vertical',\r\n                  whiteSpace: 'pre-wrap',\r\n                  overflowWrap: 'anywhere',\r\n                  wordBreak: 'break-word',\r\n                  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Consolas, monospace',\r\n                  fontSize: 14,\r\n                  lineHeight: 1.5,\r\n                  background: selectedTemplate ? '#fff' : '#f9fafb',\r\n                }}\r\n              />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Row 3: Valediction */}\r\n        <div \r\n          style={{ \r\n            display: 'grid', \r\n            gridTemplateColumns: 'min-content min-content 1fr', \r\n            gap: 8, \r\n            marginBottom: 12 \r\n          }}\r\n        >\r\n          <div>\r\n            <label \r\n              className= { elements.subtitle }\r\n            >\r\n              Closing\r\n            </label>\r\n            <select\r\n              value={selectedValediction}\r\n              onChange={(e) => setSelectedValediction(e.target.value)}\r\n              className= { elements.select }\r\n            >\r\n              <option value=\"\">— none —</option>\r\n              {valedictions.map((v) => <option key={v} value={v}>{v}</option>)}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Row 4: Signature */}\r\n          <div>\r\n            <label \r\n              className= { elements.subtitle }\r\n            >\r\n              Signature\r\n            </label>\r\n\r\n            <select\r\n              value={selectedSignatureName}\r\n              onChange={(e) => setSelectedSignatureName(e.target.value)}\r\n              className= { elements.select }\r\n            >\r\n              <option value=\"\">— none —</option>\r\n              {signatureNames.map((n) => <option key={n} value={n}>{n}</option>)}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}